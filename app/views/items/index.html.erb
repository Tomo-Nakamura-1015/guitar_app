<%= javascript_pack_tag 'star' %>

<h2>アイテム検索フォーム</h2>
<div>
<%= search_form_for @q do |f| %>
  <%= f.label :name_or_address, "キーワード" %>
  <%= f.search_field :name_or_company_cont %>
  <%= f.submit "検索" %>
<% end %>
</div>

<% if @result.any? %>
  <div>
    <p>検索結果：<%= @result.count %>件</p>
    <% @result.each do |result| %>
      <li>
        <p><%= image_tag result.img.url, :size => '40x40' %> <%= link_to result.name, item_path(result) %></p>
        <div>メーカー：<%= result.company %></div>
        <span id="star-rate-<%= result.id %>"></span>
        <span>（口コミ：<%= result.comments.count %>件）</span>

        <script>
          $('#star-rate-<%= result.id %>').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            readOnly: true,
            half: true,
            score: <%= result.comments.average(:rate).to_f.round(1) %>,
          });
        </script> 
    
        <p>説明文</p>
        <p><%= result.subject %></p>
      </li>
    <% end %>
  </div>
<% else %>
  <P>検索結果：見つかりませんでした</p>
<% end %>